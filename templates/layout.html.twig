{% filter spaceless %}
{% set profilePhoto = 'img/avatar2.png' %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{% block title %}{% endblock %} | {{  title_long }}</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta name="generator" content="SEMART SKELETON" />
    <meta name="version" content="{{ version }}" />
    <meta name="source" content="https://github.com/KejawenLab/SemartSkeleton" />
    <meta name="author" content="MUHAMAD SURYA IKSANUDIN" />
    <meta name="email" content="surya.kejawen@gmail.com" />
    <link rel="stylesheet" href="{{ asset('lib/bootstrap/dist/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ asset('lib/font-awesome/css/font-awesome.min.css') }}">
    <link rel="stylesheet" href="{{ asset('lib/Ionicons/css/ionicons.min.css') }}">
    <link rel="stylesheet" href="{{ asset('css/AdminLTE.min.css') }}">
    <link rel="stylesheet" href="{{ asset('css/skins/skin-purple-light.min.css') }}">
    <link rel="stylesheet" href="{{ asset('css/semart.css') }}">
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <link rel="stylesheet" href="{{ asset('lib/toastr/toastr.min.css') }}">
    <style>
        #first-loader.basic-loader {
            display: none;
            z-index: 9998;
            background-image: url('{{ asset('img/loader.gif') }}');
            background-color: #f8f8f8;
            position: fixed;
        }

        .basic-loader {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: hsla(0, 0%, 100%, 0.8);
            background-position: center;
            background-repeat: no-repeat;
            /*background-size: 70px 70px;*/
            z-index: 9998;
        }

        .basic-loader.fixed-container {
            position: fixed !important;
            z-index: 9998;
        }

        .mouse-pointer {
            cursor: pointer;
        }
    </style>
    {% block stylesheets %}{% endblock %}
</head>
<body class="hold-transition skin-purple-light sidebar-mini">
    <div class="wrapper">
        <header class="main-header">
            <a href="{{ path('home_dashboard') }}" class="logo">
                <span class="logo-mini"><b>SMR</b></span>
                <span class="logo-lg"><b>Sem</b>Art</span>
            </a>
            <nav class="navbar navbar-static-top">
                <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                    <span class="sr-only">Toggle Navigation</span>
                </a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        {% block top_nav_widget %}{% endblock %}
                        {% set user = app.user %}
                        {% set group = user.group %}
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="{{ asset(profilePhoto) }}" class="user-image" alt="{{ user.username }}">
                                <span class="hidden-xs">{{ user.username }}</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="user-header">
                                    <img src="{{ asset(profilePhoto) }}" class="img-circle" alt="{{ user.username }}">
                                    <p>{{ user.fullName }}<small>{{ group.code ~ ' - ' ~ group.name }}</small></p>
                                </li>
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="{{ path('profile_index') }}" class="btn btn-default btn-flat">{{ 'label.user.profile' | trans }}</a>
                                    </div>
                                    <div class="pull-right">
                                        <a href="{{ path('logout') }}" class="btn btn-default btn-flat">{{ 'label.login.logout' | trans }}</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <aside class="main-sidebar">
            <section class="sidebar">
                <ul class="sidebar-menu" data-widget="tree">
                    {{ render_menu() | raw }}
                </ul>
            </section>
        </aside>
        <div class="content-wrapper">
            <section class="content-header">
                <h1>{% block page_title %}{% endblock %}</h1>
                <ol class="breadcrumb">
                    {% block breadcrumb %}{% endblock %}
                </ol>
            </section>
            <section class="content">
                {% block content %}{% endblock %}
            </section>
        </div>
        <footer class="main-footer">
            <div class="pull-right hidden-xs">
                <b>Version</b> {{ version }}
            </div>
            <strong>Copyright &copy; 2018-{{ date('now') | date('Y') }}.</strong> All rights reserved.
        </footer>
        <div class="control-sidebar-bg"></div>
    </div>
    <script src="{{ asset('lib/jquery/dist/jquery.min.js') }}"></script>
    <script src="{{ asset('lib/bootstrap/dist/js/bootstrap.min.js') }}"></script>
    <script src="{{ asset('lib/fastclick/lib/fastclick.js') }}"></script>
    <script src="{{ asset('js/adminlte.min.js') }}"></script>
    <script src="{{ asset('lib/jquery-slimscroll/jquery.slimscroll.min.js') }}"></script>
    <script src="{{ asset('lib/toastr/toastr.min.js') }}"></script>
    <script src="{{ asset('js/jquery.numeric.min.js') }}"></script>
    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>
    <script>
        $(document).ready(function () {
            toastr.options = {
                'closeButton': false,
                'debug': false,
                'newestOnTop': false,
                'progressBar': false,
                'positionClass': 'toast-top-right',
                'preventDuplicates': false,
                'onclick': null,
                'showDuration': '300',
                'hideDuration': '1000',
                'timeOut': '3000',
                'extendedTimeOut': '1000',
                'showEasing': 'swing',
                'hideEasing': 'linear',
                'showMethod': 'fadeIn',
                'hideMethod': 'fadeOut'
            };

            $('[data-toggle="tooltip"]').tooltip();

            $('.modal').on('hidden.bs.modal', function () {
                $(this)
                    .find('input,textarea,select')
                    .val('')
                    .end()
                    .find('input[type=checkbox], input[type=radio]')
                    .prop('checked', '')
                    .end()
                ;
            });

            $('.numeric').keyup(function(e) {
                if (/\D/g.test(this.value)) {
                    this.value = this.value.replace(/\D/g, '');
                }
            });

            $('.phoneNumber').number(true, 0, '.', '-');
            $('.number').number(true, 0);

            $(document).on('click', '.sortable', function () {
                sort(jQuery(this));
            });

            $(document).on('click', '.refresh', function () {
                refreshTable(window.location.href, '{{ title }}');
            });

            let params = getQueriesString();

            if ('undefined' !== typeof params['q']) {
                delete params['q'];

                refreshTable(window.location.href.split('?')[0] + '?' + $.param(params), '{{ title }}');
            }

            if ('undefined' !== typeof params['s']) {
                jQuery('.sortable').each(function () {
                    let elm = jQuery(this);
                    let sortField = elm.data('sort-field');
                    let direction = params['d'];
                    if (sortField === params['s']) {
                        elm.removeClass('fa-sort');
                        elm.removeClass('fa-sort-asc');
                        elm.removeClass('fa-sort-desc');
                        switch (direction) {
                            case 'n':
                                elm.addClass('fa-sort');
                                break;
                            case 'a':
                                elm.addClass('fa-sort-asc');
                                break;
                            case 'd':
                                elm.addClass('fa-sort-desc');
                                break;
                        }
                    }
                });
            }
        });

        function refreshTable(url, title) {
            let container = $('body');

            container.semartLoader();

            $.get(url, {}, function (response) {
                $('.table-content').html(response['table']);
                $('.pagination-box').html(response['pagination']);

                localStorage.setItem('cache_id', response['_cache_id']);
                window.history.pushState(response, title, url);

                container.trigger('destroy.semart.loader');
            });
        }

        function formReset(callback) {
            let form = $('#semartForm');

            form.trigger('reset');
            form.find('select').val('');
            if ('function' === typeof callback) {
                callback();
            }
        }

        function sort(element) {
            jQuery('.sortable').each(function () {
                let elm = jQuery(this);

                elm.removeClass('fa-sort');
                elm.removeClass('fa-sort-asc');
                elm.removeClass('fa-sort-desc');
                if (!elm.is(element)) {
                    elm.addClass('fa-sort');
                    elm.data('sort', 'no');
                }
            });

            let direction = element.data('sort');
            let field = element.data('sort-field');
            switch (direction) {
                case 'no':
                    element.removeClass('fa-sort');
                    element.addClass('fa-sort-asc');
                    element.data('sort', 'asc');
                    direction = 'a';
                    break;
                case 'asc':
                    element.removeClass('fa-sort-asc');
                    element.addClass('fa-sort-desc');
                    element.data('sort', 'desc');
                    direction = 'd';
                    break;
                case 'desc':
                    element.removeClass('fa-sort-desc');
                    element.addClass('fa-sort');
                    element.data('sort', 'no');
                    direction = 'n';
                    break;
            }

            let params = getQueriesString();

            params['s'] = field;
            params['d'] = direction;

            refreshTable(window.location.href.split('?')[0] + '?' + $.param(params), '{{ title }}');
        }

        function upload(formData, callback) {
            $.ajax({
                url:Routing.generate('files_upload'),
                data: formData,
                type: 'post',
                contentType:false,
                processData:false,
                cache:false,
                dataType: 'json',
                error:function(err){
                    localStorage.setItem('csrf_token', err._csrf_token);
                },
                success:function(response){
                    localStorage.setItem('csrf_token', response._csrf_token);
                    if ('OK' === response.status) {
                        if ('function' === typeof callback) {
                            callback(response.files);
                        }
                    }
                }
            });
        }

        function getQueriesString() {
            let vars = {};
            let hash = null;
            let hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for(let i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                if ('undefined' !== typeof hash[1]) {
                    vars[hash[0]] = hash[1];
                }
            }

            return vars;
        }

        (function ($) {
            $.fn.semartLoader = function (opt) {
                let $element = this;

                let loader = new Loader($element, opt); //initialize loader
                //initialize custom handler to the elements
                let handler = {
                    'destroy.semart.loader': $.proxy(function () {
                        let self = this;
                        loader.destroy();
                    }, this)
                };
                $element.on(handler);

                return $element;
            };

            // default settings
            let settings = {
                loader_img: '{{ asset('img/loader.gif') }}',
                className: 'basic-loader',
                containerName: 'loader-container',
                minHeight: 200,
                fixedLoader: false,
                afterDestroy: function () {
                    //after loader destroyed, what you will do, put it here
                }
            };

            let Loader = function (target, opt) {
                if (target.length < 1) {
                    return;
                }

                this.$target = target;
                this.$obj = {};
                this.settings = $.extend(settings, opt);

                this._htmlInit();
            };

            Loader.prototype._htmlInit = function () {
                let self = this;
                let $obj = $('<div/>', {
                    'class': self.settings.className + (self.settings.fixedLoader ? ' fixed-container' : ''),
                    'style': 'background-image:url(' + self.settings.loader_img + ')'
                });
                self.$target.addClass(self.settings.containerName);
                self.$target.get(0).style.minHeight = self.settings.minHeight + 'px';
                self.$target.append($obj);
                self.$obj = self.$target.find('.' + self.settings.className);
            };

            Loader.prototype.destroy = function () {
                let self = this;
                self.$obj.fadeOut(500).promise().done(function () {
                    self.$obj.remove();
                    if (self.settings.afterDestroy)
                        self.settings.afterDestroy();
                    //self.$target.removeClass(self.settings.containerName);
                    self.$target.get(0).style.minHeight = '';
                });
            };
        }(jQuery));
    </script>
    {% block javascripts %}{% endblock %}
</body>
</html>
{% endfilter %}
